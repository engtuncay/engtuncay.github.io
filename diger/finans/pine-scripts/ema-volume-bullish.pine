//@version=6
indicator("EMA-Volume", overlay=true)

len1 = input.int(50, "EMA1", minval=1)
len2 = input.int(200, "EMA2", minval=1)
//volLen = input.int(20, "Hacim MA UzunluÄŸu", minval=1)

// Ayar Parametreleri
src  = input.source(close, "Kaynak")
showEma1 = input.bool(true, "EMA1 gÃ¶ster")
showEma2 = input.bool(true, "EMA2 gÃ¶ster")
showVolume = input.bool(true, "Hacim analizini gÃ¶ster")
showVolumeMA = input.bool(true, "Hacim MA gÃ¶ster")

//showNotes = input.bool(true, "NotlarÄ± gÃ¶ster")
customNote = input.string("Analiz Notu", "Ã–zel not")

showLabels = input.bool(true, "GeÃ§iÅŸ etiketlerini gÃ¶ster")

ema1 = ta.ema(src, len1) // 50
ema2 = ta.ema(src, len2) // 200

// GeÃ§iÅŸ koÅŸullarÄ±nÄ± global deÄŸiÅŸkenlere atayalÄ±m
bullishCross = ta.crossover(ema1, ema2)
bearishCross = ta.crossunder(ema1, ema2)

// Hacimli geÃ§iÅŸler
// bullishCrossWithVolume = bullishCross and highVolume
// bearishCrossWithVolume = bearishCross and highVolume

plot(showEma1 ? ema1 : na, title="EMA1", color=color.orange, linewidth=2)
plot(showEma2 ? ema2 : na, title="EMA2", color=color.rgb(33, 243, 243),linewidth=2)

// Hacim hesaplamalarÄ±
scaleVolume = 100000

volumeUsd = volume*close 

volumeMA1 = ta.sma(volumeUsd/scaleVolume, 30) // purple
volumeMA2 = ta.sma(volumeUsd/scaleVolume, 120) // gri

// Bullish Sezon analizi iÃ§in hacim ortalamalarÄ±
volumeMA30 = ta.sma(volume, 30)  // 30 gÃ¼nlÃ¼k hacim ortalamasÄ±
volumeMA120 = ta.sma(volume, 120) // 120 gÃ¼nlÃ¼k hacim ortalamasÄ±
bullishVolumeSeason = volumeMA30 > volumeMA120 // Bullish sezon sinyali

// GeliÅŸmiÅŸ hacim analizi
volumeSpike = volume > volumeMA30 * 2.0 // Hacim patlamasÄ±
volumeDrought = volume < volumeMA30 * 0.5 // Hacim kuraklÄ±ÄŸÄ±

highVolume = volume > volumeMA1 * 1.5 // volumeMa 20
lowVolume = volume < volumeMA1 * 0.7

var table volumeTable2 = table.new(position.bottom_left, 2, 5, bgcolor=color.white, border_width=1)
table.cell(volumeTable2, 0, 0, "Hacim Analizi", text_color=color.black, text_size=size.small, bgcolor=color.gray)
table.cell(volumeTable2, 1, 0, "Durum", text_color=color.black, text_size=size.small, bgcolor=color.gray)
table.cell(volumeTable2, 0, 1, "Vol30/120", text_color=color.black, text_size=size.small)
table.cell(volumeTable2, 1, 1, bullishVolumeSeason ? "BULLISH" : "BEARISH", text_color=bullishVolumeSeason ? color.green : color.red, text_size=size.small)
table.cell(volumeTable2, 0, 2, "Hacim Spike", text_color=color.black, text_size=size.small)
table.cell(volumeTable2, 1, 2, volumeSpike ? "EVET" : "HAYIR", text_color=volumeSpike ? color.orange : color.gray, text_size=size.small)
table.cell(volumeTable2, 0, 3, "Hacim Drought", text_color=color.black, text_size=size.small)
table.cell(volumeTable2, 1, 3, volumeDrought ? "EVET" : "HAYIR", text_color=volumeDrought ? color.red : color.gray, text_size=size.small)
table.cell(volumeTable2, 0, 4, "Sezon Durumu", text_color=color.black, text_size=size.small)
table.cell(volumeTable2, 1, 4, bullishVolumeSeason ? "ðŸš€ BULLISH SEZON" : "ðŸ“‰ NORMAL", text_color=bullishVolumeSeason ? color.lime : color.gray, text_size=size.normal)

// Hacim MA Ã§izgisi (fiyat grafiÄŸinin altÄ±nda kÃ¼Ã§Ã¼k bir Ã§izgi olarak)
// plot(volumeUsd/scaleVolume, title="Vol-Usd", color=color.green, linewidth=1, style=plot.style_line) //, display=display.none
plot(volumeMA1, title="Vol-MA1", color=color.purple, linewidth=1, style=plot.style_line) //, display=display.none
plot(volumeMA2, title="Vol-Ma2", color=color.gray , linewidth=1, style=plot.style_line) //, display=display.none

// Bullish sezon hacim Ã§izgileri
plot(showVolumeMA ? volumeMA30/1000 : na, title="Vol-MA30", color=color.blue, linewidth=2, style=plot.style_line)
plot(showVolumeMA ? volumeMA120/1000 : na, title="Vol-MA120", color=color.orange, linewidth=2, style=plot.style_line)

// Hacim renk kodlamasÄ±
// volumeColor = highVolume ? color.red : lowVolume ? color.yellow : color.gray
//plotcandle(na, na, na, na, title="Hacim", color=color.gray, wickcolor=na, bordercolor=na, editable=false)

// Ä°stersenle geÃ§iÅŸlerde arka plan rengi
bgcolor(bullishCross ? color.new(color.green, 85) : na)
bgcolor(bearishCross ? color.new(color.red, 85) : na)

// Bullish sezon arka plan rengi
bgcolor(bullishVolumeSeason ? color.new(color.blue, 96) : na)

// Hacim spike arka plan rengi
bgcolor(volumeSpike ? color.new(color.yellow, 90) : na)

// YÃ¼ksek hacimli geÃ§iÅŸlerde daha belirgin arka plan
//bgcolor(bullishCrossWithVolume ? color.new(color.green, 70) : na)
//bgcolor(bearishCrossWithVolume ? color.new(color.red, 70) : na)

// Alternatif: plotchar ile ok iÅŸaretleri
plotchar(bullishCross, "Bullish", "â–²", location.belowbar, color.green, size=size.small)
plotchar(bearishCross, "Bearish", "â–¼", location.abovebar, color.red, size=size.small)

// Bullish sezon baÅŸlangÄ±cÄ± ve bitiÅŸi iÅŸaretleri
bullishSeasonStart = bullishVolumeSeason and not bullishVolumeSeason[1]
bullishSeasonEnd = not bullishVolumeSeason and bullishVolumeSeason[1]

plotchar(bullishSeasonStart, "Bullish Season Start", "ðŸš€", location.belowbar, color.lime, size=size.normal)
plotchar(bullishSeasonEnd, "Bullish Season End", "ðŸ“‰", location.abovebar, color.orange, size=size.normal)

// Hacim spike iÅŸaretleri
plotchar(volumeSpike, "Volume Spike", "ðŸ’¥", location.belowbar, color.yellow, size=size.small)

// YÃ¼ksek hacimli geÃ§iÅŸler iÃ§in bÃ¼yÃ¼k iÅŸaretler
//plotchar(bullishCrossWithVolume, "Bullish Vol", "â¬†", location.belowbar, color.lime, size=size.normal)
//plotchar(bearishCrossWithVolume, "Bearish Vol", "â¬‡", location.abovebar, color.maroon, size=size.normal)

// GeliÅŸmiÅŸ Hacim tablosu
if showVolume and barstate.islast
    var table volumeTable = table.new(position.top_right, 2, 7, bgcolor=color.white, border_width=1)
    table.cell(volumeTable, 0, 0, "HACIM ANALÄ°ZÄ°", text_color=color.white, text_size=size.normal, bgcolor=color.blue)
    table.cell(volumeTable, 1, 0, "DEÄžER", text_color=color.white, text_size=size.normal, bgcolor=color.blue)
    
    table.cell(volumeTable, 0, 1, "Mevcut Hacim", text_color=color.black, text_size=size.small)
    table.cell(volumeTable, 1, 1, str.tostring(volume, "#"), text_color=color.black, text_size=size.small)
    
    table.cell(volumeTable, 0, 2, "Vol30 OrtalamasÄ±", text_color=color.black, text_size=size.small)
    table.cell(volumeTable, 1, 2, str.tostring(volumeMA30, "#"), text_color=color.black, text_size=size.small)
    
    table.cell(volumeTable, 0, 3, "Vol120 OrtalamasÄ±", text_color=color.black, text_size=size.small)
    table.cell(volumeTable, 1, 3, str.tostring(volumeMA120, "#"), text_color=color.black, text_size=size.small)
    
    table.cell(volumeTable, 0, 4, "Vol30/Vol120 OranÄ±", text_color=color.black, text_size=size.small)
    table.cell(volumeTable, 1, 4, str.tostring(volumeMA30/volumeMA120, "#.##"), text_color=bullishVolumeSeason ? color.green : color.red, text_size=size.small)
    
    table.cell(volumeTable, 0, 5, "Hacim/Vol30 OranÄ±", text_color=color.black, text_size=size.small)
    table.cell(volumeTable, 1, 5, str.tostring(volume/volumeMA30, "#.##"), text_color=color.black, text_size=size.small)
    
    table.cell(volumeTable, 0, 6, "SEZON DURUMU", text_color=color.black, text_size=size.small)
    table.cell(volumeTable, 1, 6, bullishVolumeSeason ? "ðŸš€ BULLISH" : "ðŸ“‰ BEARISH", text_color=bullishVolumeSeason ? color.lime : color.red, text_size=size.normal)

